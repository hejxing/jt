<?php
/**
 * Auth: ax
 * Created: 2017/5/20 19:12
 */

namespace jt\developer\action;

use PHPUnit\Framework\TestCase;
use ReflectionMethod;

class MenuTest extends TestCase
{
    public function runPrivate($obj, $method, ...$param)
    {
        $action = new ReflectionMethod(get_class($obj), $method);
        $action->setAccessible(true);
        $action->invoke($obj, ...$param);
    }

    public function testGetByGrant()
    {
        $list = [0 => ['key' => 'j24m3jtyf7', 'type' => 'group', 'icon' => 'solution', 'name' => '账号管理', 'to' => 'account', 'desc' => '为管理员，会员单位成员注册账号', 'item' => [0 => ['key' => 'j279igp0ps', 'type' => 'node', 'icon' => 'star-o', 'name' => '机构管理', 'to' => 'mechanism', 'desc' => null, 'feature' => [0 => ['name' => '获取有效的上级机构列表', 'code' => 'get:/org/parents/:type', 'key' => 'post:/org/index', 'value' => [0 => '\\app\\action\\Organization', 1 => 'get:/org/parents/:type',], 'desc' => null,], 1 => ['name' => '修改机构', 'code' => 'put:/org/index', 'key' => 'put:/org/index', 'value' => [0 => '\\app\\action\\Organization', 1 => 'put:/org/index',], 'desc' => null, 'depend' => [0 => ['name' => '获取机构列表', 'key' => 'get:/org/list', 'value' => [0 => '\\app\\action\\Organization', 1 => 'get:/org/list',],], 1 => ['name' => '获取指定机构', 'key' => 'get:/org/:id', 'value' => [0 => '\\app\\action\\Organization', 1 => 'get:/org/:id',],],],], 2 => ['name' => '删除机构', 'code' => 'delete:/org/:id', 'key' => 'delete:/org/:id', 'value' => [0 => '\\app\\action\\Organization', 1 => 'delete:/org/:id',], 'desc' => null, 'depend' => [0 => ['name' => '获取机构列表', 'key' => 'get:/org/list', 'value' => [0 => '\\app\\action\\Organization', 1 => 'get:/org/list',],], 1 => ['name' => '获取指定机构', 'key' => 'get:/org/:id', 'value' => [0 => '\\app\\action\\Organization', 1 => 'get:/org/:id',],],],],],], 1 => ['key' => 'j279ixcqb0g', 'type' => 'node', 'icon' => 'star-o', 'name' => '角色管理', 'to' => 'role', 'desc' => null, 'feature' => [0 => ['name' => '添加角色', 'code' => 'post:/role/add', 'key' => 'post:/role/add', 'value' => [0 => '\\app\\action\\Role', 1 => 'post:/role/add',], 'desc' => null,], 1 => ['name' => '编辑角色', 'code' => 'put:/role/role/:id', 'key' => 'put:/role/role/:id', 'value' => [0 => '\\app\\action\\Role', 1 => 'put:/role/role/:id',], 'desc' => null, 'depend' => [0 => ['name' => '获取所有的角色', 'key' => 'get:/role/list', 'value' => [0 => '\\app\\action\\Role', 1 => 'get:/role/list',],], 1 => ['name' => '获取单个角色信息', 'key' => 'get:/role/:id', 'value' => [0 => '\\app\\action\\Role', 1 => 'get:/role/:id',],],],], 2 => ['name' => '删除角色', 'code' => 'delete:/role/:id', 'key' => 'delete:/role/:id', 'value' => [0 => '\\app\\action\\Role', 1 => 'delete:/role/:id',], 'desc' => null, 'depend' => [0 => ['name' => '获取单个角色信息', 'key' => 'get:/role/:id', 'value' => [0 => '\\app\\action\\Role', 1 => 'get:/role/:id',],], 1 => ['name' => '获取单个角色信息', 'key' => 'get:/role/:id', 'value' => [0 => '\\app\\action\\Role', 1 => 'get:/role/:id',],],],],],], 2 => ['key' => 'j2owm08l68c', 'type' => 'node', 'icon' => 'star-o', 'name' => '用户管理', 'to' => 'user', 'desc' => null,], 3 => ['key' => 'j2owmgwzsc', 'type' => 'node', 'icon' => 'star-o', 'name' => '微圈管理', 'to' => 'micro_group', 'desc' => null,], 4 => ['key' => 'j2owmubo5wm', 'type' => 'node', 'icon' => 'star-o', 'name' => '经纪人管理', 'to' => 'broker', 'desc' => null, 'feature' => [0 => ['name' => '申请经纪人', 'code' => 'post:/brokerManagement/add', 'key' => 'post:/brokerManagement/add', 'value' => [0 => '\\app\\action\\BrokerManagement', 1 => 'post:/brokerManagement/add',], 'desc' => '申请成为经纪人',],],],],], 1 => ['key' => 'j2n228ku7f', 'type' => 'group', 'icon' => 'team', 'name' => '客户管理', 'to' => 'customer', 'desc' => null, 'item' => [0 => ['key' => 'j2ownp4j2zl', 'type' => 'node', 'icon' => 'star-o', 'name' => '客户列表', 'to' => 'customerList', 'desc' => null,], 1 => ['key' => 'j2owocjpfqd', 'type' => 'node', 'icon' => 'star-o', 'name' => '风控管理', 'to' => 'risk', 'desc' => null,],],], 2 => ['key' => 'j24mbo0c31', 'type' => 'group', 'icon' => 'tags-o', 'name' => '商品管理', 'to' => 'product', 'desc' => null, 'item' => [0 => ['key' => 'j2owp1jhtuj', 'type' => 'node', 'icon' => 'star-o', 'name' => '商品管理', 'to' => 'goods', 'desc' => null,], 1 => ['key' => 'j2owpe6k7mn', 'type' => 'node', 'icon' => 'star-o', 'name' => '元宝管理', 'to' => 'sycee', 'desc' => null,], 2 => ['key' => 'j2owq3ukh5', 'type' => 'node', 'icon' => 'star-o', 'name' => '元宝订单列表', 'to' => 'sycee_order', 'desc' => null,],],], 3 => ['key' => 'j278nb252ro', 'type' => 'group', 'icon' => 'frown-o', 'name' => '风控管理', 'to' => 'risk', 'desc' => null, 'item' => [0 => ['key' => 'j2owqx9pls', 'type' => 'node', 'icon' => 'star-o', 'name' => '机构管理', 'to' => 'org', 'desc' => null,], 1 => ['key' => 'j2owr7ok3lq', 'type' => 'node', 'icon' => 'star-o', 'name' => '角色管理', 'to' => 'role', 'desc' => null,], 2 => ['key' => 'j2owrhsk7cj', 'type' => 'node', 'icon' => 'star-o', 'name' => '用户管理', 'to' => 'user', 'desc' => null,],],], 4 => ['key' => 'j278oop1el', 'type' => 'group', 'icon' => 'pay-circle-o', 'name' => '资金管理', 'to' => 'capital', 'desc' => null,], 5 => ['key' => 'j278p24dsz7', 'type' => 'group', 'icon' => 'bank', 'name' => '银行业务', 'to' => 'bank', 'desc' => null,], 6 => ['key' => 'j2797ga9yvt', 'type' => 'group', 'icon' => 'calculator', 'name' => '结算管理', 'to' => 'checkout', 'desc' => null,], 7 => ['key' => 'j279226pf0f', 'type' => 'group', 'icon' => 'setting', 'name' => '系统设置', 'to' => 'system', 'desc' => null, 'item' => [0 => ['key' => 'j2owtp3nzj8', 'type' => 'node', 'icon' => 'star-o', 'name' => '公告管理', 'to' => 'noticeList', 'desc' => null,], 1 => ['key' => 'j2owtz6z2ep', 'type' => 'node', 'icon' => 'star-o', 'name' => '跑马灯管理', 'to' => 'marquee', 'desc' => null,], 2 => ['key' => 'j2owtel7d2i', 'type' => 'node', 'icon' => 'star-o', 'name' => '登录日志', 'to' => 'loginLog', 'desc' => null,], 3 => ['key' => 'j2owt0oscj', 'type' => 'node', 'icon' => 'star-o', 'name' => '密码设置', 'to' => 'password', 'desc' => null,], 4 => ['key' => 'j2t9dw3o9xj', 'type' => 'node', 'icon' => 'star-o', 'name' => '机构类型', 'to' => 'org_type', 'desc' => null,], 5 => ['key' => 'j2owsov70z', 'type' => 'node', 'icon' => 'star-o', 'name' => '出入金设置', 'to' => 'disc', 'desc' => null,],],],];
        $menu = new Menu;
        $menu->filterByFeature($list, []);
        $this->assertEquals(
            [], $list
        );
    }
}
